#include        "libran.h"

double ran_norm_distr( a , b )
double a , b;   {

   static double one  = 1.0,
                 half = 0.5;
   double        result , t , u , v , w ;
   int           n;
   extern BLOCKB b_block;

   static double d[41] = {               0.0 , 0.674489750196082 , 1.150349380376008 , 1.534120544352546 , 1.862731867421652 ,
                           2.153874694061456 , 2.417559016236505 , 2.660067468617460 , 2.885634912426757 , 3.097269078198785 ,
                           3.297193345691964 , 3.487104104114431 , 3.668329285121323 , 3.841930685501911 , 4.008772594168585 ,
                           4.169569323349106 , 4.324919040826046 , 4.475328424654204 , 4.621231001499247 , 4.763001034267814 ,
                           4.900964207963193 , 5.035405969463927 , 5.166578119728753 , 5.294704084854598 , 5.419983174916868 ,
                           5.542594057802940 , 5.662697617459439 , 5.780439324478935 , 5.895951216739571 , 6.009353565530745 ,
                           6.120756285971941 , 6.230260137989044 , 6.337957754553790 , 6.443934526538564 , 6.548269367831731 ,
                           6.651035379893011 , 6.752300431407015 , 6.852127665896068 , 6.950575947916750 , 7.047700256664409 ,
                           7.143552034352190 };

   v = random_number();
   u = b_block.normal;
   n = 0;

   while( ( n < 39 ) && ( u <= half ) )   {
      u += u;
      n++;
   }

   t = d[n];
   n++;
   u = v;
   w = ( d[n] - t ) * u;
   v = w * ( w * half + t );
   u = random_number();

   while( v > u )   {
      v = random_number();
      if( u <= v )   {
         u = ( v - u ) / ( one - u );
         w = ( d[n] - t ) * u;
         v = w * ( w * half + t );
      }
      u = random_number();
   }

   u = ( u - v ) / ( one - v );

   if( u > half )   {
      b_block.normal = u + u - one;
      result         = a - b * ( w + t );
   }
   else   {
      b_block.normal = u + u;
      result         = a + b * ( w + t );
   }

   return ( result );

}
